% !TEX program = lualatex
\documentclass[aspectratio=169,professionalfonts]{beamer}
\input{../preamble.tex}
\usepackage{mwe}

\title[ClústerLab • Día 2]{Bash avanzado y transferencia}
\subtitle{Condicionales, bucles y copias seguras}
\author{Equipo docente ClústerLab}
\date{6 de agosto de 2025}

\begin{document}

%------------------------------ portada ----------------------------
\begin{frame}[plain]
  \titlepage
\end{frame}

%------------------------------ rsync -----------------------
\begin{frame}[fragile]{Rsync}
  Usa \texttt{rsync -a} para sincronizar carpetas entre dispositivos.
  \begin{minted}{bash}
    # desde local hasta remoto (subir datos)
    $ rsync -a datos pi@10.0.0.21:~/datos/
  \end{minted}
  Esto es útil para copiar datos de simulación o de análisis que se hagan de forma remota.
  \begin{minted}{bash}
    # desde remoto hasta local (bajar datos)
    $ rsync -a pi@10.0.0.21:~/datos/ datos/
  \end{minted}
\end{frame}

%------------------------------ rsync extra -----------------------
\begin{frame}[fragile]{Rsync incremental}
  \begin{minted}{bash}
$ rsync -av --delete origen/ pi@10.0.0.21:~/destino/
$ rsync -av --delete origen/ rpi21:~/destino/
  \end{minted}
  \begin{itemize}
    \item \texttt{--delete} borra en destino lo que ya no existe en origen.
    \item Ideal para copias de seguridad periódicas.
  \end{itemize}
\end{frame}

%------------------------------ ping parallel ----------------------
\begin{frame}[fragile]{Ping a todo}
  En serie: 
  \begin{minted}{bash}
for host in {1..254}; do
  ping -c1 -W1 "10.0.0.$host"
done
wait
  \end{minted}
En paralelo: 
  \begin{minted}{bash}
for host in {1..254}; do
  ping -c1 -W1 "10.0.0.$host" &
done
wait
  \end{minted}
  Ejecutar varios \texttt{ping} simultáneos reduce el tiempo total pero genera más tráfico.
\end{frame}

%------------------------------ arrays -----------------------------
\begin{frame}[fragile]{Bucles con arreglos}
  \begin{minted}{bash}
FRUTAS=(manzana pera mango)
for fruta in "${FRUTAS[@]}"; do
  echo "Me gusta la $fruta"
done
  \end{minted}
  \begin{itemize}
    \item Las comillas dobles preservan espacios si los hay.
    \item Añade más elementos y ejecuta de nuevo el ciclo.
  \end{itemize}
\end{frame}

%------------------------------ condicionales ----------------------
\begin{frame}[fragile]{Condicionales en Bash}
  Evaluar condiciones y ejecutar bloques de código:
  \begin{minted}{bash}
#!/usr/bin/env bash
FILE="$1"
if [ -f "$FILE" ]; then
  echo "El archivo $FILE existe"
elif [ -d "$FILE" ]; then
  echo "$FILE es un directorio"
else
  echo "No existe $FILE"
fi
  \end{minted}
  \begin{infobox}
  Las expresiones entre corchetes \texttt{[ ]} admiten comparaciones de cadenas (\texttt{=}, \texttt{!=}) y números (\texttt{-lt}, \texttt{-eq}, etc.).
  \end{infobox}
\end{frame}

%------------------------------ transferencia ---------------------
\begin{frame}[fragile]{Transferencia con \texttt{scp} y \texttt{rsync}}
  Copia un archivo a la Pi:
  \begin{minted}{bash}
$ scp informe.pdf pi@10.0.0.21:~/
  \end{minted}
  Sincroniza un directorio local con el remoto:
  \begin{minted}{bash}
$ rsync -avz proyectos/ pi@10.0.0.21:~/proyectos/
  \end{minted}
  \begin{infobox}
  La opción \texttt{-z} de \texttt{rsync} habilita compresión; \texttt{-a} conserva permisos y tiempos.
  \end{infobox}
\end{frame}

%------------------------------ hash -------------------------------
\begin{frame}[fragile]{Verificación con \texttt{sha256sum}}
  Calcula y compara hashes para asegurar integridad:
  \begin{minted}{bash}
$ sha256sum archivo.txt
e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855  archivo.txt
  \end{minted}
  \begin{itemize}
    \item Ejecuta el comando antes y después de transferir.
    \item Si los hashes coinciden, la copia es correcta.
  \end{itemize}
\end{frame}

%------------------------------ actividad --------------------------
\begin{frame}[fragile]{Actividad práctica}
  \begin{enumerate}
    \item Implementa y ejecuta \texttt{ping\_all.sh} en tu subred.
    \item Prueba la variante en paralelo y compara el tiempo de ejecución.
    \item Copia un archivo de al menos 10 MB a tu Pi usando \texttt{scp} y mide el tiempo.
    \item Repite la copia con \texttt{rsync} y compara tiempos.
    \item Verifica los hashes SHA-256 para confirmar integridad.
  \end{enumerate}
\end{frame}

%------------------------------ resumen ----------------------------
\begin{frame}[fragile]{Resumen}
  \begin{itemize}
    \item Aprendiste a escribir condicionales y bucles en Bash.
    \item Creaste un script para mapear y medir latencias en la red.
    \item Transferiste y sincronizaste archivos de forma eficiente y segura.
  \end{itemize}
  \vspace{0.5em}
  ¡Terminó la configuración básica de tu entorno remoto!
\end{frame}

\end{document}